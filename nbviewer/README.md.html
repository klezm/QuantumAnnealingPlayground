<p><strong><a href="#quick-run">Quick Run</a></strong> | <strong><a href="#github-enterprise">GitHub Enterprise</a></strong> | <strong><a href="#base-url">Base URL</a></strong> | <strong><a href="#local-development">Local Development</a></strong> | <strong><a href="#contributing">Contributing</a></strong> | <strong><a href="#extending-the-notebook-viewer">Extensions</a></strong> | <strong><a href="#config-file-and-command-line-configuration">Configuration</a></strong> | <strong><a href="#securing-the-notebook-viewer">Security</a></strong></p>
<h1 id="jupyter-notebook-viewer">Jupyter Notebook Viewer</h1>
<p><a href="https://pypi.python.org/pypi/nbviewer"><img src="https://img.shields.io/pypi/v/nbviewer?logo=pypi" alt="Latest PyPI version" /></a> <a href="https://travis-ci.org/jupyter/nbviewer"><img src="https://img.shields.io/travis/jupyter/nbviewer/master?logo=travis" alt="TravisCI build status" /></a> <a href="https://github.com/jupyter/nbviewer/issues"><img src="https://img.shields.io/badge/issue_tracking-github-blue?logo=github" alt="GitHub" /></a> <a href="https://gitter.im/jupyter/nbviewer"><img src="https://img.shields.io/badge/social_chat-gitter-blue?logo=gitter" alt="Gitter" /></a></p>
<p>Jupyter NBViewer is the web application behind <a href="http://nbviewer.org">The Jupyter Notebook Viewer</a>, which is graciously hosted by <a href="https://ovhcloud.com">OVHcloud</a> and CDN services provided by <a href="https://www.fastly.com/">fastly</a>.</p>
<p>Run this locally to get most of the features of nbviewer on your own network.</p>
<p>If you need help using or installing Jupyter Notebook Viewer, please use the <a href="https://github.com/jupyter/help">jupyter/help</a> issue tracker. If you would like to propose an enhancement to nbviewer or file a bug report, please <a href="https://github.com/jupyter/nbviewer">open an issue here, in the jupyter/nbviewer project</a>.</p>
<h2 id="quick-run">Quick Run</h2>
<p>If you have <code>docker</code> installed, you can pull and run the currently built version of the Docker container by</p>
<pre class="shell"><code>docker pull jupyter/nbviewer
docker run -p 8080:8080 jupyter/nbviewer</code></pre>
<p>It automatically gets built with each push to <code>master</code>, so you’ll always be able to get the freshest copy.</p>
<p>For speed and friendliness to GitHub, be sure to set <code>GITHUB_OAUTH_KEY</code> and <code>GITHUB_OAUTH_SECRET</code>:</p>
<pre class="shell"><code>docker run -p 8080:8080 -e &#39;GITHUB_OAUTH_KEY=YOURKEY&#39; \
                          -e &#39;GITHUB_OAUTH_SECRET=YOURSECRET&#39; \
                          jupyter/nbviewer</code></pre>
<p>Or to use your GitHub personal access token, you can just set <code>GITHUB_API_TOKEN</code>.</p>
<h2 id="github-enterprise">GitHub Enterprise</h2>
<p>To use nbviewer on your own GitHub Enterprise instance you need to set <code>GITHUB_API_URL</code>. The relevant <a href="https://developer.github.com/v3/enterprise/">API endpoints for GitHub Enterprise</a> are prefixed with <code>http://hostname/api/v3</code>. You must also specify your <code>OAUTH</code> or <code>API_TOKEN</code> as explained above. For example:</p>
<pre class="shell"><code>docker run -p 8080:8080 -e &#39;GITHUB_OAUTH_KEY=YOURKEY&#39; \
                          -e &#39;GITHUB_OAUTH_SECRET=YOURSECRET&#39; \
                          -e &#39;GITHUB_API_URL=https://ghe.example.com/api/v3/&#39; \
                          jupyter/nbviewer</code></pre>
<p>With this configured all GitHub API requests will go to your Enterprise instance so you can view all of your internal notebooks.</p>
<h2 id="base-url">Base URL</h2>
<p>If the environment variable <code>JUPYTERHUB_SERVICE_PREFIX</code> is specified, then NBViewer <em>always</em> uses the value of this environment variable as the base URL.</p>
<p>In the case that there is no value for <code>JUPYTERHUB_SERVICE_PREFIX</code>, then as a backup the value of the <code>--base-url</code> flag passed to the <code>python -m nbviewer</code> command on the command line will be used as the base URL.</p>
<h2 id="local-development">Local Development</h2>
<h3 id="with-docker">With Docker</h3>
<p>You can build a docker image that uses your local branch.</p>
<h4 id="build">Build</h4>
<pre class="shell"><code>cd &lt;path to repo&gt;
docker build -t nbviewer .</code></pre>
<h4 id="run">Run</h4>
<pre class="shell"><code>cd &lt;path to repo&gt;
docker run -p 8080:8080 nbviewer</code></pre>
<h3 id="with-docker-compose">With Docker Compose</h3>
<p>The Notebook Viewer uses <code>memcached</code> in production. To locally try out this setup, a <a href="https://docs.docker.com/compose/">docker-compose</a> configuration is provided to easily start/stop the <code>nbviewer</code> and <code>memcached</code> containers together from your current branch. You will need to install <code>docker</code> prior to this.</p>
<h4 id="run-1">Run</h4>
<pre class="shell"><code>cd &lt;path to repo&gt;
pip install docker-compose
docker-compose up</code></pre>
<h3 id="local-installation">Local Installation</h3>
<p>The Notebook Viewer requires several binary packages to be installed on your system. The primary ones are <code>libmemcached-dev libcurl4-openssl-dev pandoc libevent-dev libgnutls28-dev</code>. Package names may differ on your system, see <a href="https://github.com/rgbkrk/salt-states-nbviewer/blob/master/nbviewer/init.sls">salt-states</a> for more details.</p>
<p>If they are installed, you can install the required Python packages via pip.</p>
<pre class="shell"><code>$ cd &lt;path to repo&gt;
$ pip install -r requirements.txt</code></pre>
<h4 id="static-assets">Static Assets</h4>
<p>Static assets are maintained with <code>bower</code> and <code>less</code> (which require having <code>npm</code> installed), and the <code>invoke</code> python module.</p>
<pre class="shell"><code>$ cd &lt;path to repo&gt;
$ pip install -r requirements-dev.txt
$ npm install
$ invoke bower
$ invoke less [-d]</code></pre>
<p>This will download the relevant assets into <code>nbviewer/static/components</code> and create the built assets in <code>nbviewer/static/build</code>.</p>
<p>Pass <code>-d</code> or <code>--debug</code> to <code>invoke less</code> to create a CSS sourcemap, useful for debugging.</p>
<h4 id="running-locally">Running Locally</h4>
<pre class="shell"><code>$ cd &lt;path to repo&gt;
$ python -m nbviewer --debug --no-cache --host=127.0.0.1</code></pre>
<p>This will automatically relaunch the server if a change is detected on a python file, and not cache any results. You can then just do the modifications you like to the source code and/or the templates then refresh the pages.</p>
<h2 id="contributing">Contributing</h2>
<p>If you would like to contribute to the project, please read the <a href="CONTRIBUTING.md"><code>CONTRIBUTING.md</code></a>. The <code>CONTRIBUTING.md</code> file explains how to set up a development installation and how to run the test suite.</p>
<h2 id="extending-the-notebook-viewer">Extending the Notebook Viewer</h2>
<h3 id="providers">Providers</h3>
<p>Providers are sources of notebooks and directories of notebooks and directories.</p>
<p><code>nbviewer</code> ships with several providers - <code>url</code> - <code>gist</code> - <code>github</code> - <code>huggingface</code> - <code>local</code></p>
<h4 id="writing-a-new-provider">Writing a new Provider</h4>
<p>There are already several providers <a href="https://github.com/jupyter/nbviewer/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+label%3Atag%3AProvider">proposed/requested</a>. Some providers are more involved than others, and some, such as those which would require user authentication, will take some work to support properly.</p>
<p>A provider is implemented as a python module, which can expose a few functions:</p>
<h5 id="uri_rewrites"><code>uri_rewrites</code></h5>
<p>If you just need to rewrite URLs (or URIs) of another site/namespace, implement <code>uri_rewrites</code>, which will allow the front page to transform an arbitrary string (usually an URI fragment), escape it correctly, and turn it into a “canonical” nbviewer URL. See the <a href="./nbviewer/providers/dropbox/handlers.py">dropbox provider</a> for a simple example of rewriting URLs without using a custom API client.</p>
<h5 id="default_handlers"><code>default_handlers</code></h5>
<p>If you need custom logic, such as connecting to an API, implement <code>default_handlers</code>. See the <a href="./nbviewer/providers/github/handlers.py">github provider</a> for a complex example of providing multiple handlers.</p>
<h5 id="error-handling">Error Handling</h5>
<p>While you <em>could</em> re-implement upstream HTTP error handling, a small convenience method is provided for intercepting HTTP errors. On a given URL handler that inherits from <code>BaseHandler</code>, overload the <code>client_error_message</code> and re-call it with your message (or <code>None</code>). See the <a href="./nbviewer/providers/gist/handlers.py">gist provider</a> for an example of customizing the error message.</p>
<h3 id="formats">Formats</h3>
<p>Formats are ways to present notebooks to the user.</p>
<p><code>nbviewer</code> ships with three providers: - <code>html</code> - <code>slides</code> - <code>script</code></p>
<h4 id="writing-a-new-format">Writing a new Format</h4>
<p>If you’d like to write a new format, open a ticket, or speak up on <a href="https://gitter.im/jupyter/nbviewer">gitter</a>! We have some work yet to do to support your next big thing in notebook publishing, and we’d love to hear from you.</p>
<h2 id="config-file-and-command-line-configuration">Config File and Command Line Configuration</h2>
<p>NBViewer is configurable using a config file, by default called <code>nbviewer_config.py</code>. You can modify the name and location of the config file that NBViewer looks for using the <code>--config-file</code> command line flag. (The location is always a relative path, i.e. relative to where the command <code>python -m nbviewer</code> is run, and never an absolute path.)</p>
<p>If you don’t know which attributes of NBViewer you can configure using the config file, run <code>python -m nbviewer --generate-config</code> (or <code>python -m nbviewer --generate-config --config-file="my_custom_name.py"</code>) to write a default config file which has all of the configurable options commented out and set to their default values. To change a configurable option to a new value, uncomment the corresponding line and change the default value to the new value.</p>
<p>You can also run <code>python -m nbviewer --help-all</code> to see all of the configurable options. This is a more comprehensive version of <code>python -m nbviewer --help</code>, which gives a list of the most common ones along with flags and aliases you can use to set their values temporarily via the command line.</p>
<p>The config file uses <a href="https://traitlets.readthedocs.io/en/stable/config.html">the standard configuration syntax for Jupyter projects</a>. For example, to configure the default port used to be 9000, add the line <code>c.NBViewer.port = 9000</code> to the config file. If you want to do this just once, you can also run <code>python -m nbviewer --NBViewer.port=9000</code> at the command line. (<code>NBViewer.port</code> also has the alias <code>port</code>, making it also possible to do, in this specific case, <code>python -m nbviewer --port=9000</code>. However not all configurable options have shorthand aliases like this; you can check using the outputs of <code>python -m nbviewer --help</code> and <code>python -m nbviewer --help-all</code> to see which ones do and which ones don’t.)</p>
<p>One thing this allows you to do, for example, is to write your custom implementations of any of the standard page rendering <a href="https://www.tornadoweb.org/en/stable/guide/structure.html#subclassing-requesthandler">handlers</a> included in NBViewer, e.g. by subclassing the original handlers to include custom logic along with custom output possibilities, and then have these custom handlers always loaded by default, by modifying the corresponding lines in the config file. This is effectively another way to extend NBViewer.</p>
<h2 id="securing-the-notebook-viewer">Securing the Notebook Viewer</h2>
<p>You can run the viewer as a <a href="https://jupyterhub.readthedocs.io/en/latest/reference/services.html">JupyterHub 0.7+ service</a>. Running the viewer as a service prevents users who have not authenticated with the Hub from accessing the nbviewer instance. This setup can be useful for protecting access to local notebooks rendered with the <code>--localfiles</code> option.</p>
<p>Add an entry like the following to your <code>jupyterhub_config.py</code> to have it start nbviewer as a managed service:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>c.JupyterHub.services <span class="op">=</span> [</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>        <span class="co"># the /services/&lt;name&gt; path for accessing the notebook viewer</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>        <span class="st">&#39;name&#39;</span>: <span class="st">&#39;nbviewer&#39;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>        <span class="co"># the interface and port nbviewer will use</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>        <span class="st">&#39;url&#39;</span>: <span class="st">&#39;http://127.0.0.1:9000&#39;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>        <span class="co"># the path to nbviewer repo</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>        <span class="st">&#39;cwd&#39;</span>: <span class="st">&#39;&lt;path to repo&gt;&#39;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>        <span class="co"># command to start the nbviewer</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>        <span class="st">&#39;command&#39;</span>: [<span class="st">&#39;python&#39;</span>, <span class="st">&#39;-m&#39;</span>, <span class="st">&#39;nbviewer&#39;</span>]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>]</span></code></pre></div>
<p>The nbviewer instance will automatically read the <a href="http://jupyterhub.readthedocs.io/en/latest/reference/services.html#launching-a-hub-managed-service">various <code>JUPYTERHUB_*</code> environment variables</a> and configure itself accordingly. You can also run the nbviewer instance as an <a href="http://jupyterhub.readthedocs.io/en/latest/reference/services.html#externally-managed-services">externally managed JupyterHub service</a>, but must set the requisite environment variables yourself.</p>
